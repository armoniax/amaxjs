import type { PublicKey } from '@amax/anchor-link';
import { APIError, IdentityProof } from '@amax/anchor-link';
import type { API } from '@greymass/eosio';
import { isInMobileBrowser, type AdapterName } from '@amax/abstract-adapter';

declare global {
    interface Window {
        armadillo?: any;
    }
}

export const aplinkAdapterName = 'APLink' as AdapterName<'APLink'>;

export const aplinkUrl = isInMobileBrowser()
    ? 'https://aplink.app/home'
    : 'https://chromewebstore.google.com/detail/armadillo/ahkbnfljhaifiikpkhnkeobchonbpjpb?hl=zh-CN&utm_source=ext_sidebar';

export const aplinkIcon =
    'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAiIGhlaWdodD0iNDAiIHZpZXdCb3g9IjAgMCA0MCA0MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjQwIiBoZWlnaHQ9IjQwIiByeD0iNiIgZmlsbD0iIzUzNkVGMyIvPgo8cmVjdCB3aWR0aD0iNDAiIGhlaWdodD0iNDAiIHJ4PSI2IiBmaWxsPSJ1cmwoI3BhaW50MF9saW5lYXJfMjc4MjRfMjY2OTgpIi8+CjxtYXNrIGlkPSJwYXRoLTItb3V0c2lkZS0xXzI3ODI0XzI2Njk4IiBtYXNrVW5pdHM9InVzZXJTcGFjZU9uVXNlIiB4PSI0Ljc3MjQ2IiB5PSI2LjY5NTMxIiB3aWR0aD0iMzAiIGhlaWdodD0iMjYiIGZpbGw9ImJsYWNrIj4KPHJlY3QgZmlsbD0id2hpdGUiIHg9IjQuNzcyNDYiIHk9IjYuNjk1MzEiIHdpZHRoPSIzMCIgaGVpZ2h0PSIyNiIvPgo8cGF0aCBmaWxsLXJ1bGU9ImV2ZW5vZGQiIGNsaXAtcnVsZT0iZXZlbm9kZCIgZD0iTTE4Ljc1MTQgNy42OTUzMUMxOC41OCA3LjY5NTMxIDE4LjQ4NzggNy43ODU4MiAxOC40Mjg4IDcuODQzNjJMMTguNDEyNiA3Ljg1OTU1TDUuODQxNiAyOS4xOUM1Ljc5MDUgMjkuMjQ4OSA1Ljc3MjQ2IDI5LjMyMzEgNS43NzI0NiAyOS4zOTA0QzUuNzcyNDYgMjkuNDY0NiA1Ljc5MzQ3IDI5LjU0MTcgNS44Mjk5IDI5LjYxM0w3LjEwMDI4IDMxLjc2M0w3LjIxMDcxIDMxLjg3MTFIMTIuNDY2N0MxMi42MzggMzEuODcxMSAxMi43MzAzIDMxLjc4MDYgMTIuNzg5MiAzMS43MjI4TDEyLjgwNTQgMzEuNzA3TDE0LjA2NCAyOS41NzdDMTQuMTE1MiAyOS41MTggMTQuMTMzMiAyOS40NDM3IDE0LjEzMzIgMjkuMzc2NEMxNC4xMzMyIDI5LjMwMjMgMTQuMTEyMiAyOS4yMjUxIDE0LjA3NTggMjkuMTUzN0wxMi45MTI4IDI3LjIwMDNMMTQuOTI0IDIzLjgyOThMMTkuNjY5OSAzMS43MDc0TDE5LjY4MzUgMzEuNzIwNUwxOS42ODQ3IDMxLjcyMTlMMTkuNjg4NCAzMS43MjUzTDE5LjcgMzEuNzM1NUMxOS43MDk0IDMxLjc0MzMgMTkuNzIyOCAzMS43NTM5IDE5LjczOTMgMzEuNzY0NUMxOS43Njc2IDMxLjc4MzEgMTkuODI0NiAzMS44MTUyIDE5Ljg5NDQgMzEuODE1MkgzMi41Nzc1QzMyLjc0ODkgMzEuODE1MiAzMi44NDExIDMxLjcyNDcgMzIuOTAwMSAzMS42NjY5TDMyLjkxNjIgMzEuNjUxMUwzNC4xNTg5IDI5LjU0NzhDMzQuMTk5MSAyOS40ODIxIDM0LjIyNzIgMjkuNDE5MiAzNC4yMjcyIDI5LjM1OTJDMzQuMjI3MiAyOS4yOTkyIDM0LjIwOTIgMjkuMjQ4MyAzNC4xNzQ5IDI5LjE5TDIxLjYwMzkgNy44NTk1NUwyMS41ODc3IDcuODQzNjJDMjEuNTI4NyA3Ljc4NTgyIDIxLjQzNjUgNy42OTUzMSAyMS4yNjUyIDcuNjk1MzFIMTguNzUxNFpNMzAuNDE1OSAyNy4wMjY2TDE5LjQ0OTMgOC40NzI1MUgyMS4wMTQ0TDMzLjEzNjQgMjguOTY2OUgyNC4zNjQzTDI1LjE3MTggMjcuNjE2OUgzMC4wNjM3QzMwLjIzNDkgMjcuNjE2OSAzMC4zMjczIDI3LjUyNjQgMzAuMzg2MSAyNy40Njg1TDMwLjM4OTUgMjcuNDY1NEMzMC40NTE4IDI3LjQwNDMgMzAuNDczMiAyNy4zMjI3IDMwLjQ3MzIgMjcuMjQ5M0MzMC40NzMyIDI3LjE3NSAzMC40NTIyIDI3LjA5NzkgMzAuNDE1OSAyNy4wMjY2Wk0yNC42OTI1IDIyLjc1NzVMMjAuMDAzIDMwLjcyOUwxNS40MjYyIDIzLjA1NzJMMTYuMTgxMiAyMS43NjI3TDE5LjYwMTQgMjcuNTQ2QzE5LjY1MDggMjcuNjM5NCAxOS43NDA1IDI3LjcgMTkuODI5MyAyNy43Mjg5QzE5LjkxMTIgMjcuNzU1NyAyMC4wMTAxIDI3Ljc2MTMgMjAuMTAwNCAyNy43MjYyQzIwLjE1ODIgMjcuNzE3MyAyMC4yMDcgMjcuNjg3OCAyMC4yNDExIDI3LjY1NDNDMjAuMjczNSAyNy42MjI3IDIwLjMwMjUgMjcuNTc4IDIwLjMxMzMgMjcuNTI0N0wyNC4xMTk1IDIxLjA2ODNDMjQuMTcwNiAyMS4wMDkzIDI0LjE4ODYgMjAuOTM1MSAyNC4xODg2IDIwLjg2NzhDMjQuMTg4NiAyMC43OTM3IDI0LjE2NzYgMjAuNzE2NSAyNC4xMzEyIDIwLjY0NTFMMTkuMTE4IDEyLjI3MjhDMTkuMTE4IDEyLjI3MjggMTkuMDM5NSAxMi4xNDYgMTguOTg0OCAxMi4wOUMxOC45MzAyIDEyLjAzNCAxOC44NjM1IDExLjk3NjQgMTguNzUgMTEuOTc2NEMxOC42MzY2IDExLjk3NjQgMTguNTY5MiAxMi4wMjI1IDE4LjUxNjQgMTIuMDgyM0MxOC40NjM2IDEyLjE0MjEgMTguNDMzOSAxMi4xODIgMTguNDAwNyAxMi4yMzk1TDcuNDM4NDMgMzAuNzM3NEw2LjYyODA4IDI5LjM4M0wxOC43NTE0IDguODg2NDZMMjkuMzY1NyAyNi44Mzk3SDI3LjgwMDNMMjUuMzg0IDIyLjc2NDhMMjUuMzc5MiAyMi43NTc3QzI1LjIxMDEgMjIuNTA5MyAyNC44NjE2IDIyLjUwOTIgMjQuNjkyNSAyMi43NTc1Wk0xMi4yMTY1IDMxLjE0OTlIOC4xMzczNEwxOC43NTA0IDEzLjI1MzhMMTkuNTA1NyAxNC41NDkxTDE3LjE1MzkgMTguNTU0M0MxNy4xMDI4IDE4LjYxMzIgMTcuMDg0OCAxOC42ODc0IDE3LjA4NDggMTguNzU0N0MxNy4wODQ4IDE4LjgyODggMTcuMTA1OCAxOC45MDU5IDE3LjE0MjIgMTguOTc3M0wyMC44MTk4IDI1LjE4NkwyMC4wMDc0IDI2LjU5MDRMMTYuNTc2NCAyMC43MzQ1TDE2LjU2IDIwLjcxODVDMTYuNTAxIDIwLjY2MDcgMTYuNDA4OCAyMC41NzAyIDE2LjIzNzUgMjAuNTcwMkMxNi4wNjYyIDIwLjU3MDIgMTUuOTczOSAyMC42NjA3IDE1LjkxNSAyMC43MTg1TDE1Ljg5OTIgMjAuNzM0TDEyLjExOTQgMjcuMDE4NEwxMC44NjEgMjkuMjAzOEwxMC44NTc4IDI5LjIwOTlDMTAuODI2MSAyOS4yNzIxIDEwLjgwMDIgMjkuMzM3MiAxMC44MDAyIDI5LjQxMTRDMTAuODAwMiAyOS40ODU2IDEwLjgyNjEgMjkuNTUwNyAxMC44NTc4IDI5LjYxMjlMMTAuODY4IDI5LjYzMjlMMTAuODg3MiAyOS42NTE3QzEwLjk0NjIgMjkuNzA5NSAxMS4wMzg1IDI5LjggMTEuMjA5OCAyOS44SDEzLjAyNDJMMTIuMjE2NSAzMS4xNDk5Wk0xNy45Mzk4IDE4Ljc0NzlMMTkuOTUyMyAxNS4zMjMzTDIzLjI3NTcgMjAuODc1MUwyMS4yMDkyIDI0LjM1MzZMMTcuOTM5OCAxOC43NDc5Wk0zMi4zMjYyIDMxLjAzOEgyMC43MDcyTDI1LjAzNDYgMjMuNzc3MkwyNS43ODk4IDI1LjA3MThMMjQuNTc0NiAyNy4wNzRMMjMuMjQwOSAyOS4yMzNWMjkuNTUyM0wyMy4yODUxIDI5LjU5NTdDMjMuMzQ0IDI5LjY1MzUgMjMuNDM2MyAyOS43NDQgMjMuNjA3NyAyOS43NDRIMzMuMDgxTDMyLjMyNjIgMzEuMDM4Wk0yNi44NTU4IDI2LjgzOTdIMjUuNjgxMUwyNi4yODg3IDI1Ljg0NzZMMjYuODU1OCAyNi44Mzk3Wk0xMy4wMTk0IDI5LjAyMjhIMTEuOTE0TDEyLjQ2NjcgMjguMTMzMkwxMy4wMTk0IDI5LjAyMjhaIi8+CjwvbWFzaz4KPHBhdGggZmlsbC1ydWxlPSJldmVub2RkIiBjbGlwLXJ1bGU9ImV2ZW5vZGQiIGQ9Ik0xOC43NTE0IDcuNjk1MzFDMTguNTggNy42OTUzMSAxOC40ODc4IDcuNzg1ODIgMTguNDI4OCA3Ljg0MzYyTDE4LjQxMjYgNy44NTk1NUw1Ljg0MTYgMjkuMTlDNS43OTA1IDI5LjI0ODkgNS43NzI0NiAyOS4zMjMxIDUuNzcyNDYgMjkuMzkwNEM1Ljc3MjQ2IDI5LjQ2NDYgNS43OTM0NyAyOS41NDE3IDUuODI5OSAyOS42MTNMNy4xMDAyOCAzMS43NjNMNy4yMTA3MSAzMS44NzExSDEyLjQ2NjdDMTIuNjM4IDMxLjg3MTEgMTIuNzMwMyAzMS43ODA2IDEyLjc4OTIgMzEuNzIyOEwxMi44MDU0IDMxLjcwN0wxNC4wNjQgMjkuNTc3QzE0LjExNTIgMjkuNTE4IDE0LjEzMzIgMjkuNDQzNyAxNC4xMzMyIDI5LjM3NjRDMTQuMTMzMiAyOS4zMDIzIDE0LjExMjIgMjkuMjI1MSAxNC4wNzU4IDI5LjE1MzdMMTIuOTEyOCAyNy4yMDAzTDE0LjkyNCAyMy44Mjk4TDE5LjY2OTkgMzEuNzA3NEwxOS42ODM1IDMxLjcyMDVMMTkuNjg0NyAzMS43MjE5TDE5LjY4ODQgMzEuNzI1M0wxOS43IDMxLjczNTVDMTkuNzA5NCAzMS43NDMzIDE5LjcyMjggMzEuNzUzOSAxOS43MzkzIDMxLjc2NDVDMTkuNzY3NiAzMS43ODMxIDE5LjgyNDYgMzEuODE1MiAxOS44OTQ0IDMxLjgxNTJIMzIuNTc3NUMzMi43NDg5IDMxLjgxNTIgMzIuODQxMSAzMS43MjQ3IDMyLjkwMDEgMzEuNjY2OUwzMi45MTYyIDMxLjY1MTFMMzQuMTU4OSAyOS41NDc4QzM0LjE5OTEgMjkuNDgyMSAzNC4yMjcyIDI5LjQxOTIgMzQuMjI3MiAyOS4zNTkyQzM0LjIyNzIgMjkuMjk5MiAzNC4yMDkyIDI5LjI0ODMgMzQuMTc0OSAyOS4xOUwyMS42MDM5IDcuODU5NTVMMjEuNTg3NyA3Ljg0MzYyQzIxLjUyODcgNy43ODU4MiAyMS40MzY1IDcuNjk1MzEgMjEuMjY1MiA3LjY5NTMxSDE4Ljc1MTRaTTMwLjQxNTkgMjcuMDI2NkwxOS40NDkzIDguNDcyNTFIMjEuMDE0NEwzMy4xMzY0IDI4Ljk2NjlIMjQuMzY0M0wyNS4xNzE4IDI3LjYxNjlIMzAuMDYzN0MzMC4yMzQ5IDI3LjYxNjkgMzAuMzI3MyAyNy41MjY0IDMwLjM4NjEgMjcuNDY4NUwzMC4zODk1IDI3LjQ2NTRDMzAuNDUxOCAyNy40MDQzIDMwLjQ3MzIgMjcuMzIyNyAzMC40NzMyIDI3LjI0OTNDMzAuNDczMiAyNy4xNzUgMzAuNDUyMiAyNy4wOTc5IDMwLjQxNTkgMjcuMDI2NlpNMjQuNjkyNSAyMi43NTc1TDIwLjAwMyAzMC43MjlMMTUuNDI2MiAyMy4wNTcyTDE2LjE4MTIgMjEuNzYyN0wxOS42MDE0IDI3LjU0NkMxOS42NTA4IDI3LjYzOTQgMTkuNzQwNSAyNy43IDE5LjgyOTMgMjcuNzI4OUMxOS45MTEyIDI3Ljc1NTcgMjAuMDEwMSAyNy43NjEzIDIwLjEwMDQgMjcuNzI2MkMyMC4xNTgyIDI3LjcxNzMgMjAuMjA3IDI3LjY4NzggMjAuMjQxMSAyNy42NTQzQzIwLjI3MzUgMjcuNjIyNyAyMC4zMDI1IDI3LjU3OCAyMC4zMTMzIDI3LjUyNDdMMjQuMTE5NSAyMS4wNjgzQzI0LjE3MDYgMjEuMDA5MyAyNC4xODg2IDIwLjkzNTEgMjQuMTg4NiAyMC44Njc4QzI0LjE4ODYgMjAuNzkzNyAyNC4xNjc2IDIwLjcxNjUgMjQuMTMxMiAyMC42NDUxTDE5LjExOCAxMi4yNzI4QzE5LjExOCAxMi4yNzI4IDE5LjAzOTUgMTIuMTQ2IDE4Ljk4NDggMTIuMDlDMTguOTMwMiAxMi4wMzQgMTguODYzNSAxMS45NzY0IDE4Ljc1IDExLjk3NjRDMTguNjM2NiAxMS45NzY0IDE4LjU2OTIgMTIuMDIyNSAxOC41MTY0IDEyLjA4MjNDMTguNDYzNiAxMi4xNDIxIDE4LjQzMzkgMTIuMTgyIDE4LjQwMDcgMTIuMjM5NUw3LjQzODQzIDMwLjczNzRMNi42MjgwOCAyOS4zODNMMTguNzUxNCA4Ljg4NjQ2TDI5LjM2NTcgMjYuODM5N0gyNy44MDAzTDI1LjM4NCAyMi43NjQ4TDI1LjM3OTIgMjIuNzU3N0MyNS4yMTAxIDIyLjUwOTMgMjQuODYxNiAyMi41MDkyIDI0LjY5MjUgMjIuNzU3NVpNMTIuMjE2NSAzMS4xNDk5SDguMTM3MzRMMTguNzUwNCAxMy4yNTM4TDE5LjUwNTcgMTQuNTQ5MUwxNy4xNTM5IDE4LjU1NDNDMTcuMTAyOCAxOC42MTMyIDE3LjA4NDggMTguNjg3NCAxNy4wODQ4IDE4Ljc1NDdDMTcuMDg0OCAxOC44Mjg4IDE3LjEwNTggMTguOTA1OSAxNy4xNDIyIDE4Ljk3NzNMMjAuODE5OCAyNS4xODZMMjAuMDA3NCAyNi41OTA0TDE2LjU3NjQgMjAuNzM0NUwxNi41NiAyMC43MTg1QzE2LjUwMSAyMC42NjA3IDE2LjQwODggMjAuNTcwMiAxNi4yMzc1IDIwLjU3MDJDMTYuMDY2MiAyMC41NzAyIDE1Ljk3MzkgMjAuNjYwNyAxNS45MTUgMjAuNzE4NUwxNS44OTkyIDIwLjczNEwxMi4xMTk0IDI3LjAxODRMMTAuODYxIDI5LjIwMzhMMTAuODU3OCAyOS4yMDk5QzEwLjgyNjEgMjkuMjcyMSAxMC44MDAyIDI5LjMzNzIgMTAuODAwMiAyOS40MTE0QzEwLjgwMDIgMjkuNDg1NiAxMC44MjYxIDI5LjU1MDcgMTAuODU3OCAyOS42MTI5TDEwLjg2OCAyOS42MzI5TDEwLjg4NzIgMjkuNjUxN0MxMC45NDYyIDI5LjcwOTUgMTEuMDM4NSAyOS44IDExLjIwOTggMjkuOEgxMy4wMjQyTDEyLjIxNjUgMzEuMTQ5OVpNMTcuOTM5OCAxOC43NDc5TDE5Ljk1MjMgMTUuMzIzM0wyMy4yNzU3IDIwLjg3NTFMMjEuMjA5MiAyNC4zNTM2TDE3LjkzOTggMTguNzQ3OVpNMzIuMzI2MiAzMS4wMzhIMjAuNzA3MkwyNS4wMzQ2IDIzLjc3NzJMMjUuNzg5OCAyNS4wNzE4TDI0LjU3NDYgMjcuMDc0TDIzLjI0MDkgMjkuMjMzVjI5LjU1MjNMMjMuMjg1MSAyOS41OTU3QzIzLjM0NCAyOS42NTM1IDIzLjQzNjMgMjkuNzQ0IDIzLjYwNzcgMjkuNzQ0SDMzLjA4MUwzMi4zMjYyIDMxLjAzOFpNMjYuODU1OCAyNi44Mzk3SDI1LjY4MTFMMjYuMjg4NyAyNS44NDc2TDI2Ljg1NTggMjYuODM5N1pNMTMuMDE5NCAyOS4wMjI4SDExLjkxNEwxMi40NjY3IDI4LjEzMzJMMTMuMDE5NCAyOS4wMjI4WiIgZmlsbD0id2hpdGUiLz4KPHBhdGggZmlsbC1ydWxlPSJldmVub2RkIiBjbGlwLXJ1bGU9ImV2ZW5vZGQiIGQ9Ik0xOC43NTE0IDcuNjk1MzFDMTguNTggNy42OTUzMSAxOC40ODc4IDcuNzg1ODIgMTguNDI4OCA3Ljg0MzYyTDE4LjQxMjYgNy44NTk1NUw1Ljg0MTYgMjkuMTlDNS43OTA1IDI5LjI0ODkgNS43NzI0NiAyOS4zMjMxIDUuNzcyNDYgMjkuMzkwNEM1Ljc3MjQ2IDI5LjQ2NDYgNS43OTM0NyAyOS41NDE3IDUuODI5OSAyOS42MTNMNy4xMDAyOCAzMS43NjNMNy4yMTA3MSAzMS44NzExSDEyLjQ2NjdDMTIuNjM4IDMxLjg3MTEgMTIuNzMwMyAzMS43ODA2IDEyLjc4OTIgMzEuNzIyOEwxMi44MDU0IDMxLjcwN0wxNC4wNjQgMjkuNTc3QzE0LjExNTIgMjkuNTE4IDE0LjEzMzIgMjkuNDQzNyAxNC4xMzMyIDI5LjM3NjRDMTQuMTMzMiAyOS4zMDIzIDE0LjExMjIgMjkuMjI1MSAxNC4wNzU4IDI5LjE1MzdMMTIuOTEyOCAyNy4yMDAzTDE0LjkyNCAyMy44Mjk4TDE5LjY2OTkgMzEuNzA3NEwxOS42ODM1IDMxLjcyMDVMMTkuNjg0NyAzMS43MjE5TDE5LjY4ODQgMzEuNzI1M0wxOS43IDMxLjczNTVDMTkuNzA5NCAzMS43NDMzIDE5LjcyMjggMzEuNzUzOSAxOS43MzkzIDMxLjc2NDVDMTkuNzY3NiAzMS43ODMxIDE5LjgyNDYgMzEuODE1MiAxOS44OTQ0IDMxLjgxNTJIMzIuNTc3NUMzMi43NDg5IDMxLjgxNTIgMzIuODQxMSAzMS43MjQ3IDMyLjkwMDEgMzEuNjY2OUwzMi45MTYyIDMxLjY1MTFMMzQuMTU4OSAyOS41NDc4QzM0LjE5OTEgMjkuNDgyMSAzNC4yMjcyIDI5LjQxOTIgMzQuMjI3MiAyOS4zNTkyQzM0LjIyNzIgMjkuMjk5MiAzNC4yMDkyIDI5LjI0ODMgMzQuMTc0OSAyOS4xOUwyMS42MDM5IDcuODU5NTVMMjEuNTg3NyA3Ljg0MzYyQzIxLjUyODcgNy43ODU4MiAyMS40MzY1IDcuNjk1MzEgMjEuMjY1MiA3LjY5NTMxSDE4Ljc1MTRaTTMwLjQxNTkgMjcuMDI2NkwxOS40NDkzIDguNDcyNTFIMjEuMDE0NEwzMy4xMzY0IDI4Ljk2NjlIMjQuMzY0M0wyNS4xNzE4IDI3LjYxNjlIMzAuMDYzN0MzMC4yMzQ5IDI3LjYxNjkgMzAuMzI3MyAyNy41MjY0IDMwLjM4NjEgMjcuNDY4NUwzMC4zODk1IDI3LjQ2NTRDMzAuNDUxOCAyNy40MDQzIDMwLjQ3MzIgMjcuMzIyNyAzMC40NzMyIDI3LjI0OTNDMzAuNDczMiAyNy4xNzUgMzAuNDUyMiAyNy4wOTc5IDMwLjQxNTkgMjcuMDI2NlpNMjQuNjkyNSAyMi43NTc1TDIwLjAwMyAzMC43MjlMMTUuNDI2MiAyMy4wNTcyTDE2LjE4MTIgMjEuNzYyN0wxOS42MDE0IDI3LjU0NkMxOS42NTA4IDI3LjYzOTQgMTkuNzQwNSAyNy43IDE5LjgyOTMgMjcuNzI4OUMxOS45MTEyIDI3Ljc1NTcgMjAuMDEwMSAyNy43NjEzIDIwLjEwMDQgMjcuNzI2MkMyMC4xNTgyIDI3LjcxNzMgMjAuMjA3IDI3LjY4NzggMjAuMjQxMSAyNy42NTQzQzIwLjI3MzUgMjcuNjIyNyAyMC4zMDI1IDI3LjU3OCAyMC4zMTMzIDI3LjUyNDdMMjQuMTE5NSAyMS4wNjgzQzI0LjE3MDYgMjEuMDA5MyAyNC4xODg2IDIwLjkzNTEgMjQuMTg4NiAyMC44Njc4QzI0LjE4ODYgMjAuNzkzNyAyNC4xNjc2IDIwLjcxNjUgMjQuMTMxMiAyMC42NDUxTDE5LjExOCAxMi4yNzI4QzE5LjExOCAxMi4yNzI4IDE5LjAzOTUgMTIuMTQ2IDE4Ljk4NDggMTIuMDlDMTguOTMwMiAxMi4wMzQgMTguODYzNSAxMS45NzY0IDE4Ljc1IDExLjk3NjRDMTguNjM2NiAxMS45NzY0IDE4LjU2OTIgMTIuMDIyNSAxOC41MTY0IDEyLjA4MjNDMTguNDYzNiAxMi4xNDIxIDE4LjQzMzkgMTIuMTgyIDE4LjQwMDcgMTIuMjM5NUw3LjQzODQzIDMwLjczNzRMNi42MjgwOCAyOS4zODNMMTguNzUxNCA4Ljg4NjQ2TDI5LjM2NTcgMjYuODM5N0gyNy44MDAzTDI1LjM4NCAyMi43NjQ4TDI1LjM3OTIgMjIuNzU3N0MyNS4yMTAxIDIyLjUwOTMgMjQuODYxNiAyMi41MDkyIDI0LjY5MjUgMjIuNzU3NVpNMTIuMjE2NSAzMS4xNDk5SDguMTM3MzRMMTguNzUwNCAxMy4yNTM4TDE5LjUwNTcgMTQuNTQ5MUwxNy4xNTM5IDE4LjU1NDNDMTcuMTAyOCAxOC42MTMyIDE3LjA4NDggMTguNjg3NCAxNy4wODQ4IDE4Ljc1NDdDMTcuMDg0OCAxOC44Mjg4IDE3LjEwNTggMTguOTA1OSAxNy4xNDIyIDE4Ljk3NzNMMjAuODE5OCAyNS4xODZMMjAuMDA3NCAyNi41OTA0TDE2LjU3NjQgMjAuNzM0NUwxNi41NiAyMC43MTg1QzE2LjUwMSAyMC42NjA3IDE2LjQwODggMjAuNTcwMiAxNi4yMzc1IDIwLjU3MDJDMTYuMDY2MiAyMC41NzAyIDE1Ljk3MzkgMjAuNjYwNyAxNS45MTUgMjAuNzE4NUwxNS44OTkyIDIwLjczNEwxMi4xMTk0IDI3LjAxODRMMTAuODYxIDI5LjIwMzhMMTAuODU3OCAyOS4yMDk5QzEwLjgyNjEgMjkuMjcyMSAxMC44MDAyIDI5LjMzNzIgMTAuODAwMiAyOS40MTE0QzEwLjgwMDIgMjkuNDg1NiAxMC44MjYxIDI5LjU1MDcgMTAuODU3OCAyOS42MTI5TDEwLjg2OCAyOS42MzI5TDEwLjg4NzIgMjkuNjUxN0MxMC45NDYyIDI5LjcwOTUgMTEuMDM4NSAyOS44IDExLjIwOTggMjkuOEgxMy4wMjQyTDEyLjIxNjUgMzEuMTQ5OVpNMTcuOTM5OCAxOC43NDc5TDE5Ljk1MjMgMTUuMzIzM0wyMy4yNzU3IDIwLjg3NTFMMjEuMjA5MiAyNC4zNTM2TDE3LjkzOTggMTguNzQ3OVpNMzIuMzI2MiAzMS4wMzhIMjAuNzA3MkwyNS4wMzQ2IDIzLjc3NzJMMjUuNzg5OCAyNS4wNzE4TDI0LjU3NDYgMjcuMDc0TDIzLjI0MDkgMjkuMjMzVjI5LjU1MjNMMjMuMjg1MSAyOS41OTU3QzIzLjM0NCAyOS42NTM1IDIzLjQzNjMgMjkuNzQ0IDIzLjYwNzcgMjkuNzQ0SDMzLjA4MUwzMi4zMjYyIDMxLjAzOFpNMjYuODU1OCAyNi44Mzk3SDI1LjY4MTFMMjYuMjg4NyAyNS44NDc2TDI2Ljg1NTggMjYuODM5N1pNMTMuMDE5NCAyOS4wMjI4SDExLjkxNEwxMi40NjY3IDI4LjEzMzJMMTMuMDE5NCAyOS4wMjI4WiIgc3Ryb2tlPSJ3aGl0ZSIgc3Ryb2tlLXdpZHRoPSIwLjIiIG1hc2s9InVybCgjcGF0aC0yLW91dHNpZGUtMV8yNzgyNF8yNjY5OCkiLz4KPGRlZnM+CjxsaW5lYXJHcmFkaWVudCBpZD0icGFpbnQwX2xpbmVhcl8yNzgyNF8yNjY5OCIgeDE9IjM1LjgyNDIiIHkxPSIzOC42ODEzIiB4Mj0iNS40OTQ1MSIgeTI9IjIuMTk3OCIgZ3JhZGllbnRVbml0cz0idXNlclNwYWNlT25Vc2UiPgo8c3RvcCBvZmZzZXQ9IjAuMjEzNTQyIiBzdG9wLWNvbG9yPSIjNTM2RUYzIi8+CjxzdG9wIG9mZnNldD0iMC45OTQ3OTIiIHN0b3AtY29sb3I9IiM1RDc3RjciLz4KPC9saW5lYXJHcmFkaWVudD4KPC9kZWZzPgo8L3N2Zz4K';

export async function verifyProof(
    link: any,
    identity: any
): Promise<{
    account: API.v1.AccountObject;
    proof: IdentityProof;
    proofKey: PublicKey;
    proofValid: true;
}> {
    // Create a proof helper based on the identity results from anchor-link
    const proof = IdentityProof.from(identity.proof);

    // Load the account data from a blockchain API
    let account: API.v1.AccountObject;
    try {
        account = await link.client.v1.chain.get_account(proof.signer.actor);
    } catch (error) {
        if (error instanceof APIError && error.code === 0) {
            throw new Error('No such account');
        } else {
            throw error;
        }
    }

    // Retrieve the auth from the permission specified in the proof
    const auth = account.getPermission(proof.signer.permission as any).required_auth as any;

    // Determine if the auth is valid with the given proof
    const valid = proof.verify(auth, account.head_block_time as any);

    // If not valid, throw error
    if (!valid) {
        throw new Error('Proof invalid or expired');
    }

    // Recover the key from this proof
    const proofKey = proof.recover();

    // Return the values expected by this demo application
    return {
        account,
        proof,
        // @ts-ignore
        proofKey,
        proofValid: valid,
    };
}
